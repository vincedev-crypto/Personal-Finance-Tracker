<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title th:text="${transaction.id != null ? 'Edit Transaction' : 'Add Transaction'}">Transaction Form</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link th:href="@{/css/dashboard.css}" rel="stylesheet">
    <link th:href="@{/css/transaction.css}" rel="stylesheet">
    </head>
<body class="dark-theme">
    <div th:replace="~{sidebar :: sidebar}"></div>

    <main class="main-content">
        <div class="container content-within-main pt-4">
            <h2 class="dashboard-title-style mb-4">Add New Transaction</h2>

            <div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show mt-3" role="alert">
                <i class="fas fa-exclamation-triangle me-2"></i><span th:text="${errorMessage}">Error placeholder</span>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
             <div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show mt-3" role="alert">
                <i class="fas fa-check-circle me-2"></i><span th:text="${successMessage}">Success placeholder</span>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>

            <div class="card content-card">
                <div class="card-body">
                    <form th:action="@{/transactions/add}" th:object="${transaction}" method="post" id="transactionForm" enctype="multipart/form-data">
                        <div class="mb-3">
                            <label for="description" class="form-label">Description</label>
                            <input type="text" class="form-control" id="description" th:field="*{description}" required />
                        </div>

                        <div class="mb-3">
                            <label for="amount" class="form-label">Amount (₱)</label>
                            <input type="number" step="0.01" class="form-control" id="amount" th:field="*{amount}" required min="0.01" />
                        </div>

                        <div class="mb-3">
                            <label for="transactionDateString" class="form-label">Date of Transaction</label>
                            <input type="date" class="form-control" id="transactionDateString" name="transactionDateString"
                                   th:value="${transaction.id == null ? '' : (transaction.transactionDate != null ? #temporals.format(transaction.transactionDate, 'yyyy-MM-dd') : #temporals.format(#temporals.createNow(), 'yyyy-MM-dd'))}" required />
                        </div>

                        <div class="mb-3">
                            <label for="type" class="form-label">Type</label>
                            <select class="form-select" id="type" th:field="*{type}" required>
                                <option value="Income">Income</option>
                                <option value="Expense" th:selected="${transaction.type == 'Expense' or (transaction.type == null and transaction.id == null)}">Expense</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="category" class="form-label">Category</label>
                            <select class="form-select" id="category" th:field="*{category}" required>
                                <option value="">Select Category</option>
                                <optgroup label="Expenses">
                                    <option value="Food" th:selected="*{category == 'Food'}">Food</option>
                                    <option value="Transportation" th:selected="*{category == 'Transportation'}">Transportation</option>
                                    <option value="Bills" th:selected="*{category == 'Bills'}">Bills</option>
                                    <option value="Entertainment" th:selected="*{category == 'Entertainment'}">Entertainment</option>
                                    <option value="Shopping" th:selected="*{category == 'Shopping'}">Shopping</option>
                                    <option value="Healthcare" th:selected="*{category == 'Healthcare'}">Healthcare</option>
                                    <option value="Education" th:selected="*{category == 'Education'}">Education</option>
                                    <option value="Housing" th:selected="*{category == 'Housing'}">Housing</option>
                                </optgroup>
                                <optgroup label="Income">
                                    <option value="Salary" th:selected="*{category == 'Salary'}">Salary</option>
                                    <option value="Freelance" th:selected="*{category == 'Freelance'}">Freelance</option>
                                    <option value="Investment" th:selected="*{category == 'Investment'}">Investment</option>
                                </optgroup>
                                <option value="Other" th:selected="*{category == 'Other'}">Other</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="fileReceipt" class="form-label">Upload Receipt (Optional)</label>
                            <input type="file" class="form-control" id="fileReceipt" name="fileReceipt" />
                        </div>

                        <div class="mt-4">
                            <button type="button" class="btn btn-dashboard-primary" id="saveTransactionBtn">
                                <i class="fas fa-save me-1"></i> Save Transaction
                            </button>
                            <a th:href="@{/transactions}" class="btn btn-dashboard-secondary">
                                <i class="fas fa-times me-1"></i> Cancel
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </main>

    <div class="modal fade" id="transactionConfirmModal" tabindex="-1" aria-labelledby="transactionConfirmModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content bg-dark text-light">
          <div class="modal-header border-secondary">
            <h5 class="modal-title" id="transactionConfirmModalLabel">Confirm Transaction</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p>Please review your transaction details:</p>
            <p><strong>Description:</strong> <span id="confirmDescriptionModal"></span></p>
            <p><strong>Amount:</strong> ₱<span id="confirmAmountModal"></span></p>
            <p><strong>Date:</strong> <span id="confirmDateModal"></span></p>
            <p><strong>Type:</strong> <span id="confirmTypeModal"></span></p>
            <p><strong>Category:</strong> <span id="confirmCategoryModal"></span></p>
            <p><strong>Receipt:</strong> <span id="confirmFileModal"></span></p>
          </div>
          <div class="modal-footer border-secondary">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-primary" id="confirmSubmitButtonModal">Confirm & Save</button>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script th:src="@{/js/transaction-form-modal.js}"></script>
</body>
</html>